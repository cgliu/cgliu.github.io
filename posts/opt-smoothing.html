<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title></title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Chenggang Liu's Homepage</title>
<link rel="stylesheet" href="../fonts/Serif/cmun-serif.css" />
<link rel="stylesheet" href="../fonts/Serif-Slanted/cmun-serif-slanted.css" />
<!--BOOTSTRAP-->
<link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
<!--mobile first-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--removed html from url but still is html-->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!--fonts: allan & cardo-->
<link href="../css/sticky-footer-navbar.css" rel="stylesheet">
<link href="../css/inlineDisqussions.css" rel="stylesheet">
<!--Highlight-->
<link href="../highlight/styles/github.css" rel="stylesheet">
<link href="../favicon.ico" rel="shortcut icon" />
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link href="./css/default.css" rel="stylesheet">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<nav class="navbar navbar-inverse navbar-static-top" role="navigation">
  <div class="container">
    <!--Toggle header for mobile-->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand active" href="../index.html" id="home">Chenggang Liu's Homepage</a>
    </div>
    <!--normal header-->
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="../index.html"><span class="glyphicon glyphicon-home"></span>  Home</a></a></li>
        <li><a href="../blog.html"><span class="glyphicon glyphicon-pencil"></span>  Blog</a></li>
        <li><a href="../projects.html"><span class="glyphicon glyphicon-tags"></span>  Projects</a></li>
        <li><a href="../about.html"><span class="glyphicon glyphicon-user"></span>  About</a></li>
        <li><a href="../contact.html"><span class="glyphicon glyphicon-envelope"></span>  Contact</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>


<ul class="org-ul">
<li><a id="org1c2cfa7"></a>Optimal Smoothing and Its Application<br />
<ul class="org-ul">
<li><a id="orgcd4a2a8"></a>Optimal Smoothing Background<br />
<ul class="org-ul">
<li><a id="orga4bd601"></a>Optimal smoothing<br />
<div class="outline-text-4" id="text-orga4bd601">
<p>
To quantify the uncertainty associated with an unobserved variable, \(X\), given some information pertaining to that
variable, \(Y\). In a sequential context, this relates to the calculation of the posterior density, \(p(x_{1:T}|
   y_{1:T})\), where \(x_{1:T} := {x_1, \ldots, x_T }\), \(y_{1:T} := {y_1, \ldots, y_T}\), are the state to estimate and the
observation processes, and the discrete time index \(t\in \mathbb{N}^+\).
</p>

<p>
To facilitate sequential estimation, a first order Markovian state space model is
often assumed and defined by its initial probability \(X_1 \sim \mu(\cdot)\) and
for \(t > 0\):
</p>

<p>
\[ X_t| (X_{t-1} = x_{t-1}) \sim f(\cdot| x_{t-1});   \]
</p>

<p>
Furthermore, the observations are conditional upon the state and are
assumed to be statistically independent and distributed according to:
</p>

<p>
\[ Y_t | (X_t=x_t) \sim g(\cdot| x_t), \]
</p>

<p>
where we assume that \(\mu(\cdot)\), \(f(\cdot| x_{t-1})\) and \(g(\cdot| x_t)\) are
probability densities with respect to some dominating measure.
</p>

<p>
The joint posterior density \(p(x_{1:T}| y_{1:T})\) is simply given by:
\[ p(x_{1:t}| y_{1:t}) \propto \mu(x_1)\prod_{k=2}^{t}f(x_k | x_{k-1}) \prod_{k=1}^{t} g(y_k | x_k) \]
</p>

<p>
Given the empirical observations \(y_{1:T}\), the optimal fix-interval smoother
tries to find a sequence of the state variables that gives the maximum a
posterior probability (MAP):
</p>

\begin{equation}
\max_{x_{1:T}} \mu(x_1)\prod_{k=2}^{t}f(x_k | x_{k-1}) \prod_{k=1}^{t} g(y_k | x_k)
\end{equation}

<p>
subjective to
\[ X_t| (X_{t-1} = x_{t-1}) \sim f(\cdot| x_{t-1});   \]
\[ Y_t | (X_t=x_t) \sim g(\cdot| x_t), \]
\[ X_1 \sim \mu(\cdot) \]
</p>
</div>
</li>
<li><a id="orgfef9461"></a>Optimal linear quadratic smoother<br />
<div class="outline-text-4" id="text-orgfef9461">
<p>
The process model:
\[ x_{k} = A_k x_{k-1}  + w_{k-1}  \]
The observation model:
\[ y_k = H_k x_k + v_k\]
</p>

<p>
where \(w_k\) is the process noise which is assumed to be drawn from a zero
mean multivariate normal distribution, \(w_k \sim \mathcal{N}(0, Q_k)\), and
\(v_k\) is the observation noise which is assumed to be zero mean Gaussian
white noise with covariance \(R_k\), \(v_k \sim \mathcal{N}(0, R_k)\). The
covariances of the two noise models are assumed stationary over time and are
given by: \[ Q = E(w_k, w_k) \] \[ R = E(v_k, v_k) \]
</p>

<p>
Recall Eq. \ref{eq:1}, for the linear process model and observation model, we have:
\[ \mu(x_1) = |2 \pi P|^{-2} \exp(-(x_1 - \hat{x}_1)^{\top} P^{-1} (x_1 - \hat{x}_1)) \]
\[ f(x_k| x_{k-1}) = |2 \pi Q|^{-2} \exp(-(x_k - A_{k-1} x_{k-1})^{\top} Q^{-1}  (x_k - A_{k-1} x_{k-1}) ) \]
\[ g(y_k| x_k) = |2 \pi R|^{-2} \exp(-(y_k - H_k x_k)^{\top} R^{-1} (y_k - H_k x_k)) \]
where \(\hat{x}_1\) and \(P\) are the initial state's prior estimation and covariance.
</p>

<p>
Then, the fix-interval optimal smoother problem can be reformulated as:
</p>
\begin{equation}
\min_{x_{1:T}} \frac{1}{2} \sum_{k=1}^{N} v_k^{\top} R^{-1} v_k +
\frac{1}{2} \sum_{k=2}^{T} w_k^{\top} Q^{-1} w_k +
\frac{1}{2} (x_1 -\hat{x}_1)^{\top} P^{-1} (x_1 - \hat{x}_1)
\end{equation}
<p>
where
\[ v_k = y_k - H_k x_k \]
\[w_k = x_k - A_{k-1} x_{k-1} \]
</p>

<p>
In practice, Eq. \ref{eq:2} can be solved by batch least square (BLS)
estimation methods or sequential recursive estimation methods, such as Fraser
and Potter (1969), Rauch, Tung, and Striebel (1965), and etc.
</p>
</div>
</li>
</ul>
</li>

<li><a id="org0f5134a"></a>Human drive trajectory smoothing (opt-fitter)<br />
<ul class="org-ul">
<li><a id="orge7157c3"></a>Definition<br />
<div class="outline-text-4" id="text-orge7157c3">
<p>
The opt-fitter estimates the state sequence \(x_{1:T}\) based on the
observation sequence \(y_{1:T}\) in an optimal manner. The state we are
interested in: \[ x := [ p_x, p_y, \theta, \delta, u, s, \dot{\delta},
    \ddot{\delta}, \dot{u}, \ddot{u}]^{\top} \in \mathbb{R}^{10} \] and the
observation: \[ y := [p_x, p_y, \theta, \delta, u ]^{\top} \in
    \mathbb{R}^5, \]
</p>

<p>
where \(p_x\) and \(p_y\) is the position, \(\theta\) is the heading of car,
\(s\), \(u\), \(\dot{u}\), and \(\ddot{u}\) are the odometry, the speed, the acceleration and the jerk,
\(\delta\), \(\dot{\delta}\), and \(\ddot{\delta}\) are the steering wheel angle, swirl and juke.
</p>
</div>
</li>

<li><a id="org3e731e0"></a>Approach<br />
<div class="outline-text-4" id="text-org3e731e0">
<p>
The opt-fitter implements a linear quadratic optimal smoother
using a batch least-square (BLS) estimation method, where
the process model:
</p>
\begin{equation}
x_i =
\begin{bmatrix}
A_{i-1} & B_{i-1}\\
0 & 0
\end{bmatrix}_{10\times 10}
x_{i-1} + w
\end{equation}

<p>
The observation model:
</p>
\begin{equation}
y_i =
\begin{bmatrix}
I_{5 \times 5} & 0
\end{bmatrix}_{5 \times 10}
x_i + v
\end{equation}

<p>
where \(A_i\) is the discrete-time state jacobian and \(B_i\) is the discrete-time control jacobain at time step \(i\), \(w
    \sim \mathcal{N}(0, Q)\) and \(v \sim \mathcal{N}(0, R)\) is the process noise and the observation noise. In our
design, we use iLQR to solve \ref{eq:2}. The iLQR is a gradient-based direct method for trajectory optimization. One
thing we need to notice is the iLQR explicitly satisfies the car dynamics for the whole trajectory, which means the
state transition noise for the first 8 state variables must be set to zero (lose of generality here). We also need
to notice that the posterior covariance is relatively higher towards the beginning and the end than the middle.
These findings provide us opportunities and directions to explore.
</p>

<p>
For implementation details, please refer to the design document.
</p>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</body>
</html>
